SELECT
 CONSTITUENT_DETAILS.STOCK_KEY,
 CONSTITUENT_DETAILS.TICKER,
 CONSTITUENT_DETAILS.INDEX_NAME,
 CONSTITUENT_DETAILS.GV_KEY,
 SECURITY_PRICE.CLOSE_PRICE as s_close,
 SECURITY_PRICE.ADJUSTMENT_FACTOR_2,
 SECURITY_PRICE.SHARES_OUTSTANDING,
 OPTION_PRICE.VOLUME,
 OPTION_PRICE.DELTA,
 OPTION_PRICE.STRIKE,
 OPTION_PRICE.DATE,
 OPTION_PRICE.IMPLIED_VOLATILITY,
 OPTION_PRICE.EXPIRATION,
 OPTION_PRICE.BEST_OFFER,
 OPTION_PRICE.BEST_BID,
 OPTION_PRICE.CALL_PUT,
 SECURITY.TICKER,
 OPTION_PRICE.OPTION_ID,
 OPTION_VOLUME.VOLUME,
 OPTION_VOLUME.OPEN_INTEREST,
 DATEDIFF(day, OPTION_PRICE.DATE, OPTION_PRICE.EXPIRATION) AS T,
 DATE_PART(week, OPTION_PRICE.DATE) as dw
FROM
 "OPTION_PRICE"
INNER JOIN "SECURITY"
ON SECURITY.SECURITY_ID = OPTION_PRICE.SECURITY_ID
INNER JOIN "SECURITY_PRICE"
ON SECURITY_PRICE.DATE = OPTION_PRICE.DATE AND OPTION_PRICE.SECURITY_ID = SECURITY_PRICE.SECURITY_ID
INNER JOIN "CONSTITUENT_DETAILS" as CONSTITUENT_DETAILS
ON CONSTITUENT_DETAILS.TICKER = SECURITY.TICKER
INNER JOIN "OPTION_VOLUME"
ON
OPTION_VOLUME.SECURITY_ID = OPTION_PRICE.SECURITY_ID AND OPTION_VOLUME.DATE = OPTION_PRICE.DATE AND OPTION_VOLUME.CALL_PUT = OPTION_PRICE.CALL_PUT
WHERE
CONSTITUENT_DETAILS.INDEX_NAME = 'S&P 500' AND T >=28 AND T <=31